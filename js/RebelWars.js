
var Constants;(function(Constants_1){var Constants=(function(){function Constants(){this.DEFAULT_START_LEVEL=1;this.DEFAULT_HIGH_SCORE_COOKIE_NAME='RebelWarsHighScores';this.INFO_TEXT_SPACING=18;this.MAX_HIGH_SCORES=5;this.KEY_LEFT=37;this.KEY_UP=38;this.KEY_RIGHT=39;this.KEY_DOWN=40;this.KEY_SPACEBAR=32;this.KEY_ENTER=13;this.KEY_S=83;this.CLIENT_WINDOW_MARGIN=10;this.CANNON_SHOT_RADIUS=4;this.CANNON_SHOT_OFFSET_Y=-2;this.MISSILE_RADIUS=6;this.MISSILE_OFFSET_Y=-2;this.IMPERIAL_SHOT_RADIUS=4;this.IMPERIAL_MISSILE_RADIUS=8;this.TURRET_SPRAY_RADIUS=4;this.DEATH_STAR_PROJECTILE_OFFSET_X=93;this.DEATH_STAR_PROJECTILE_OFFSET_Y=82;this.BOUNTY_HUNTER_PROJECTILE_OFFSET_X=50;this.BOUNTY_HUNTER_PROJECTILE_OFFSET_Y=100;this.DESTROYER_HEIGHT_HIT_FACTOR=2;this.REBEL_SHIP_HEIGHT_HIT_FACTOR=2;this.TIE_FIGHTER_HEIGHT_HIT_FACTOR=2;this.COMMANDER_HEIGHT_HIT_FACTOR=2;this.DEATH_STAR_HEIGHT_HIT_FACTOR=2;this.BOUNTY_HUNTER_HEIGHT_HIT_FACTOR=2;this.MESSAGE_RISE_FACTOR_Y=1;this.MESSAGE_EXPIRE_COUNT=175;this.MESSAGE_THROTTLE_COUNT=50;this.MISSILE_LIMIT=1;this.CANNON_SHOT_LIMIT=10;this.COMMANDER_IMPERIAL_SHOT_LIMIT=10;this.COMMANDER_IMPERIAL_SHOT_FIRE_RATE=0.5;this.DEATH_STAR_IMPERIAL_SHOT_LIMIT=10;this.DEATH_STAR_IMPERIAL_SHOT_FIRE_RATE=1;this.DEATH_STAR_IMPERIAL_MISSILE_LIMIT=2;this.DEATH_STAR_IMPERIAL_MISSILE_FIRE_RATE=1;this.DEATH_STAR_NUM_MULTI_SHOT=1;this.BOUNTY_HUNTER_TURRET_SPRAY_LIMIT=12;this.BOUNTY_HUNTER_TURRET_SPRAY_FIRE_RATE=1;this.BOUNTY_HUNTER_NUM_MULTI_SHOT=2;this.NUM_FIGHTERS_PER_LEVEL=3;this.NUM_DESTROYERS_PER_LEVEL=1;this.MAX_SECONDS_MULTIPLIER_PER_LEVEL=10;this.LEVEL_LOAD_BUFFER_SECONDS=2;this.COMMANDER_LEVEL_FACTOR=3;this.DEATH_STAR_LEVEL_FACTOR=5;this.BOUNTY_HUNTER_LEVEL_FACTOR=7;this.ADD_MISSILE_LEVEL=3;this.ADD_HEALTH_LEVEL=5;this.ENEMY_STAT_INCREASE_LEVEL=10;this.BASE_SPEED=256;this.REBEL_SHIP_SPEED=this.BASE_SPEED;this.TIE_FIGHTER_SPEED=(this.BASE_SPEED/4);this.DESTROYER_SPEED=(this.BASE_SPEED/6);this.CANNON_SHOT_SPEED=this.BASE_SPEED;this.MISSILE_SPEED=(this.BASE_SPEED/2);this.COMMANDER_SPEED=(this.BASE_SPEED/4);this.DEATH_STAR_SPEED=(this.BASE_SPEED/6);this.BOUNTY_HUNTER_SPEED=(this.BASE_SPEED/1);this.TURRET_SPRAY_SPEED=this.BASE_SPEED;this.IMPERIAL_SHOT_SPEED=this.BASE_SPEED;this.IMPERIAL_MISSILE_SPEED=(this.BASE_SPEED/2);this.CANNON_SHOT_BLUE='CANNON_SHOT_BLUE';this.MISSLE_PINK='MISSLE_PINK';this.IMPERIAL_RED='IMPERIAL_RED';this.IMPERIAL_ORANGE='IMPERIAL_ORANGE';this.TURRET_GREEN='TURRET_GREEN';this.WHITE='WHITE';this.FILL_WHITE='rgb(250, 250, 250)';this.FILL_YELLOW='rgb(239, 255, 0)';this.FILL_RED='rgb(255, 0, 0)';this.FILL_GREEN='rgb(0, 255, 0)';this.FILL_BLUE='rgb(0, 0, 255)';this.FILL_LIGHT_BLUE='rgb(0, 230, 255)';this.FILL_ORANGE='rgb(255, 160, 0)';this.CANNON_SHOT_DAMAGE=1;this.IMPERIAL_SHOT_DAMAGE=1;this.IMPERIAL_MISSILE_DAMAGE=3;this.TURRET_SPRAY_DAMAGE=1;this.MISSILE_DAMAGE=5;this.TIE_FIGHTER_HEALTH=1;this.DESTROYER_HEALTH=5;this.COMMANDER_HEALTH=20;this.DEATH_STAR_HEALTH=50;this.BOUNTY_HUNTER_HEALTH=30;this.REBEL_SHIP_HEALTH=3;this.DEFAULT_DIRECTION_CHANGE_SECONDS=5;}
Constants.prototype.getColor=function(key){switch(key){case this.CANNON_SHOT_BLUE:return'#00ffdf';case this.MISSLE_PINK:return'#f000ff';case this.IMPERIAL_RED:return'#FF0000';case this.IMPERIAL_ORANGE:return'#ffbf00';case this.TURRET_GREEN:return'#00ff00';case this.WHITE:default:{return'#FFF';}}};return Constants;})();Constants_1.Constants=Constants;function getShipName(type){switch(type){case ShipType.EMPIRE_COMMANDER:return"Commander";case ShipType.EMPIRE_DEATH_STAR:return"Death Star";case ShipType.EMPIRE_DESTROYER:return"Destroyer";case ShipType.EMPIRE_TIE_FIGHTER:return"Tie Fighter";case ShipType.REBEL_MILLENIUM_FALCON:return"Millenium Falcon";case ShipType.BOUNTY_HUNTER:return"Boba Fett";default:{return type.toString();}}}
(function(ProjectileType){ProjectileType[ProjectileType["CANNON_SHOT"]=0]="CANNON_SHOT";ProjectileType[ProjectileType["MISSILE"]=1]="MISSILE";ProjectileType[ProjectileType["IMPERIAL_SHOT"]=2]="IMPERIAL_SHOT";ProjectileType[ProjectileType["IMPERIAL_MISSILE"]=3]="IMPERIAL_MISSILE";ProjectileType[ProjectileType["TURRET_SPRAY"]=4]="TURRET_SPRAY";})(Constants_1.ProjectileType||(Constants_1.ProjectileType={}));var ProjectileType=Constants_1.ProjectileType;(function(ShipType){ShipType[ShipType["REBEL_MILLENIUM_FALCON"]=0]="REBEL_MILLENIUM_FALCON";ShipType[ShipType["EMPIRE_TIE_FIGHTER"]=1]="EMPIRE_TIE_FIGHTER";ShipType[ShipType["EMPIRE_DESTROYER"]=2]="EMPIRE_DESTROYER";ShipType[ShipType["EMPIRE_COMMANDER"]=3]="EMPIRE_COMMANDER";ShipType[ShipType["EMPIRE_DEATH_STAR"]=4]="EMPIRE_DEATH_STAR";ShipType[ShipType["BOUNTY_HUNTER"]=5]="BOUNTY_HUNTER";})(Constants_1.ShipType||(Constants_1.ShipType={}));var ShipType=Constants_1.ShipType;(function(SpriteType){SpriteType[SpriteType["EXPLOSION_SMALL"]=0]="EXPLOSION_SMALL";SpriteType[SpriteType["EXPLOSION_LARGE"]=1]="EXPLOSION_LARGE";SpriteType[SpriteType["INSTRUCTION_PANEL"]=2]="INSTRUCTION_PANEL";})(Constants_1.SpriteType||(Constants_1.SpriteType={}));var SpriteType=Constants_1.SpriteType;(function(Direction){Direction[Direction["RIGHT"]=0]="RIGHT";Direction[Direction["LEFT"]=1]="LEFT";Direction[Direction["UP"]=2]="UP";Direction[Direction["DOWN"]=3]="DOWN";})(Constants_1.Direction||(Constants_1.Direction={}));var Direction=Constants_1.Direction;(function(MessageType){MessageType[MessageType["GENERIC"]=0]="GENERIC";MessageType[MessageType["ADD_MISSILE"]=1]="ADD_MISSILE";MessageType[MessageType["ADD_HEALTH"]=2]="ADD_HEALTH";MessageType[MessageType["NEW_BOSS"]=3]="NEW_BOSS";MessageType[MessageType["HIGH_SCORE"]=4]="HIGH_SCORE";MessageType[MessageType["QUOTE"]=5]="QUOTE";})(Constants_1.MessageType||(Constants_1.MessageType={}));var MessageType=Constants_1.MessageType;})(Constants||(Constants={}));var Service;(function(Service){var baseUrl="http://jovansharpe.com/rebelwarswebservice/Score.asmx";function getChampion(){var champion="N/A";var http=new XMLHttpRequest();var url=baseUrl+"/GetChampion";http.open("POST",url,false);http.setRequestHeader("Content-type","application/json; charset=utf-8");http.onreadystatechange=function(){if(http.readyState==4&&http.status==200){var data=JSON.parse(this.responseText);champion=data.d;}};http.send(null);return champion;}
Service.getChampion=getChampion;function getHighScore(name){var score=0;var http=new XMLHttpRequest();var url=baseUrl+"/GetScore";var params="{'name':'"+name+"'}";http.open("POST",url,false);http.setRequestHeader("Content-type","application/json; charset=utf-8");http.onreadystatechange=function(){if(http.readyState==4&&http.status==200){var data=JSON.parse(this.responseText);score=Number(data.d);}};http.send(params);return score;}
Service.getHighScore=getHighScore;function getHighScoreList(rows){var list=new Array();var http=new XMLHttpRequest();var url=baseUrl+"/GetScores";var params="{'numRows':'"+rows.toString()+"'}";http.open("POST",url,false);http.setRequestHeader("Content-type","application/json; charset=utf-8");http.onreadystatechange=function(){if(http.readyState==4&&http.status==200){var data=JSON.parse(this.responseText);list=convertToHighScoreList(data.d);}};http.send(params);return list;}
Service.getHighScoreList=getHighScoreList;function setHighScore(score){var http=new XMLHttpRequest();var url=baseUrl+"/InsertScore";var jsonString=JSON.stringify(score);var position=getCurrentPosition();var params="{'position':'"+position+"','input':'"+jsonString+"'}";http.open("POST",url,false);http.setRequestHeader("Content-type","application/json; charset=utf-8");http.onreadystatechange=function(){if(http.readyState==4&&http.status==200){var data="success";}};http.send(params);}
Service.setHighScore=setHighScore;function convertToHighScoreList(dataString){var list=new Array();var objList=JSON.parse(dataString);var highScoreObj;var name;var score;var displayName;objList.forEach(function(obj){name=obj["name"];score=Number(obj["highScore"]);displayName=obj["displayName"];highScoreObj=new GameObjects.HighScore(displayName,name,score);list.push(highScoreObj);});return list;}
function getCurrentPosition(){var date=new Date(Date.now());var hourString=date.getHours().toString();var text=hourString+"MayTheForceBeWithYou"+hourString;return btoa(text);}})(Service||(Service={}));var Vector;(function(Vector){var Waypoint=(function(){function Waypoint(targetX,targetY){this.targetX=targetX;this.targetY=targetY;}
Waypoint.prototype.getNextLocation=function(currentX,currentY,step){var newX=0;var newY=0;var distance=getDistance(currentX,currentY,this.targetX,this.targetY);if(distance<=step){newX=this.targetX;newY=this.targetY;}
else{var coords=getNormalizedPoint((this.targetX-currentX),(this.targetY-currentY));newX=coords.targetX*step;newY=coords.targetY*step;newX=currentX+newX;newY=currentY+newY;}
return new Waypoint(newX,newY);};return Waypoint;})();Vector.Waypoint=Waypoint;function getNormalizedPoint(x,y){var length=Math.sqrt(Math.pow(x,2)+Math.pow(y,2));return new Waypoint((x/length),(y/length));}
function getDistance(startX,startY,endX,endY){return getQuadratic((startX-endX),(startY-endY));}
function getQuadratic(a,b){return Math.sqrt(Math.pow(a,2)+Math.pow(b,2));}
function getTargetedWaypoint(startX,startY,targetX,targetY,targetVelocityX,targetVelocityY,projectileSpeed){var aimX=0;var aimY=0;var diffX=startX-targetX;var diffY=startY-targetY;var a=Math.pow(targetVelocityX,2)+Math.pow(targetVelocityY,2)-Math.pow(projectileSpeed,2);var b=2*((targetVelocityX*diffX)+(targetVelocityY*diffY));var c=Math.pow(diffX,2)+Math.pow(diffY,2);var ts=solveQuadratic(a,b,c);if(ts==null){ts=new Waypoint(targetX,targetY);}
var t0=ts.targetX;var t1=ts.targetY;var t=Math.min(t0,t1);if(t<0)
t=Math.max(t0,t1);if(t>0){aimX=targetX+targetVelocityX*t;aimY=targetY+targetVelocityY*t;}
return new Waypoint(aimX,aimY);}
Vector.getTargetedWaypoint=getTargetedWaypoint;function solveQuadratic(a,b,c){var point=null;if(Math.abs(a)<1e-6){if(Math.abs(b)<1e-6){point=Math.abs(c)<1e-6?new Waypoint(0,0):null;}
else{point=new Waypoint(-c/b,-c/b);}}
else{var disc=b*b-4*a*c;if(disc>=0){disc=Math.sqrt(disc);a=2*a;point=new Waypoint((-b-disc)/a,(-b+disc)/a);}}
return point;}
function getRandomWaypoint(minLocationX,maxLocationX,minLocationY,maxLocationY){var randomX=GameLogic.getRandomInteger(minLocationX,maxLocationX);var randomY=GameLogic.getRandomInteger(minLocationY,maxLocationY);return new Waypoint(randomX,randomY);}
Vector.getRandomWaypoint=getRandomWaypoint;})(Vector||(Vector={}));var __extends=(this&&this.__extends)||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d;}
d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};var GameObjects;(function(GameObjects){var CONSTANTS=new Constants.Constants();var isRebelShipLoaded=false;var isTieFighterLoaded=false;var isDestroyerLoaded=false;var isCommanderLoaded=false;var isDeathStarLoaded=false;var isBountyHunterLoaded=false;var isExplosionSmallLoaded=false;var isExplosionLargeLoaded=false;var isInstructionPanelLoaded=false;function isShipLoaded(type){var loaded=false;switch(type){case Constants.ShipType.EMPIRE_DESTROYER:loaded=isDestroyerLoaded;break;case Constants.ShipType.EMPIRE_TIE_FIGHTER:loaded=isTieFighterLoaded;break;case Constants.ShipType.REBEL_MILLENIUM_FALCON:loaded=isRebelShipLoaded;break;case Constants.ShipType.EMPIRE_COMMANDER:loaded=isCommanderLoaded;break;case Constants.ShipType.EMPIRE_DEATH_STAR:loaded=isDeathStarLoaded;break;case Constants.ShipType.BOUNTY_HUNTER:loaded=isBountyHunterLoaded;break;}
return loaded;}
GameObjects.isShipLoaded=isShipLoaded;function isSpriteLoaded(type){var loaded=false;switch(type){case Constants.SpriteType.EXPLOSION_SMALL:loaded=isExplosionSmallLoaded;break;case Constants.SpriteType.EXPLOSION_LARGE:loaded=isExplosionLargeLoaded;break;case Constants.SpriteType.INSTRUCTION_PANEL:loaded=isInstructionPanelLoaded;break;}
return loaded;}
GameObjects.isSpriteLoaded=isSpriteLoaded;var BaseGameObject=(function(){function BaseGameObject(currentX,currentY,canvasWidth,canvasHeight,speed,level){this.speed=speed;this.maxHeight=canvasHeight;this.maxWidth=canvasWidth;this.locationX=currentX;this.locationY=currentY;this.setSpeedBasedOnLevel(level);}
BaseGameObject.prototype.moveLocationX=function(pixels){this.locationX=this.locationX+(pixels*this.speed);};BaseGameObject.prototype.moveLocationY=function(pixels){this.locationY=this.locationY+(pixels*this.speed);};BaseGameObject.prototype.setSpeedBasedOnLevel=function(level){var factor=GameLogic.getDifficultyFactor(level);this.speed+=(this.speed*(1/4)*factor);};return BaseGameObject;})();GameObjects.BaseGameObject=BaseGameObject;var ShipObject=(function(_super){__extends(ShipObject,_super);function ShipObject(currentX,currentY,canvasWidth,canvasHeight,speed,type,createDate,health,heightHitFactor,level){_super.call(this,currentX,currentY,canvasWidth,canvasHeight,speed,level);this.type=type;this.health=health;this.maxHealth=health;this.startDate=createDate;this.heightHitFactor=heightHitFactor;this.onScreen=false;}
ShipObject.prototype.getLocationY=function(){if(this.locationY<1){this.locationY=0;}
else if(this.locationY>this.maxHeight-this.objImage.naturalHeight){this.locationY=this.maxHeight-this.objImage.naturalHeight;}
return this.locationY;};ShipObject.prototype.getMaximumY=function(){return this.getLocationY()+(this.objImage.naturalHeight/this.heightHitFactor);};ShipObject.prototype.getLocationX=function(){if(this.locationX<1){this.locationX=0;}
else if(this.locationX>this.maxWidth-this.objImage.naturalWidth){this.locationX=this.maxWidth-this.objImage.naturalWidth;}
return this.locationX;};ShipObject.prototype.getMaximumX=function(){return this.getLocationX()+this.objImage.naturalWidth;};ShipObject.prototype.getProjectileLocationStartX=function(){return this.getLocationX()+(this.objImage.naturalWidth/2);};ShipObject.prototype.getProjectileLocationStartY=function(offset){return this.getLocationY()+offset;};ShipObject.prototype.getExplosionX=function(){return this.getLocationX()+(this.objImage.naturalWidth/2);};ShipObject.prototype.getExplosionY=function(){return this.getLocationY()+(this.objImage.naturalHeight/2);};ShipObject.prototype.isAtBottomOfScreen=function(){var atBottom=false;if((this.locationY+this.objImage.naturalHeight)>this.maxHeight){atBottom=true;}
return atBottom;};ShipObject.prototype.startTimeIsValid=function(time){if(time>this.startDate.getTime()){return true;}
else{return false;}};ShipObject.prototype.moveEnemyShip=function(pixels){var step=(pixels*this.speed);if(this.type==Constants.ShipType.EMPIRE_DESTROYER&&this.locationY<(this.objImage.naturalHeight/2)){if(step<this.objImage.naturalHeight){step=(pixels*this.speed)*1.5;}}
this.locationY=this.locationY+step;};ShipObject.prototype.showEntryMessage=function(){var showMessage=false;if(!this.onScreen){this.onScreen=true;switch(this.type){case Constants.ShipType.BOUNTY_HUNTER:case Constants.ShipType.EMPIRE_COMMANDER:case Constants.ShipType.EMPIRE_DESTROYER:showMessage=true;break;}}
return showMessage;};return ShipObject;})(BaseGameObject);GameObjects.ShipObject=ShipObject;var RebelShipObject=(function(_super){__extends(RebelShipObject,_super);function RebelShipObject(canvasWidth,canvasHeight,level){var image=new Image();image.src='images/falcon2.png';image.onload=function(){isRebelShipLoaded=true;};this.objImage=image;var currentX=canvasWidth/2;var currentY=canvasHeight;this.direction=Constants.Direction.RIGHT;_super.call(this,currentX,currentY,canvasWidth,canvasHeight,CONSTANTS.REBEL_SHIP_SPEED,Constants.ShipType.REBEL_MILLENIUM_FALCON,new Date(Date.now()),CONSTANTS.REBEL_SHIP_HEALTH,CONSTANTS.REBEL_SHIP_HEIGHT_HIT_FACTOR,level);}
RebelShipObject.prototype.reset=function(){this.locationX=this.maxWidth/2;this.locationY=this.maxHeight;};RebelShipObject.prototype.getVelocityX=function(modifier){var v=(modifier*this.speed);if(this.direction==Constants.Direction.RIGHT){return v;}
else{return-v;}};RebelShipObject.prototype.getVelocityY=function(){return 0;};return RebelShipObject;})(ShipObject);GameObjects.RebelShipObject=RebelShipObject;var TieFighterObject=(function(_super){__extends(TieFighterObject,_super);function TieFighterObject(currentX,currentY,canvasWidth,canvasHeight,startTime,level){_super.call(this,currentX,currentY,canvasWidth,canvasHeight,CONSTANTS.TIE_FIGHTER_SPEED,Constants.ShipType.EMPIRE_TIE_FIGHTER,startTime,CONSTANTS.TIE_FIGHTER_HEALTH,CONSTANTS.TIE_FIGHTER_HEIGHT_HIT_FACTOR,level);var image=new Image();image.src='images/TieFighter3.png';image.onload=function(){isTieFighterLoaded=true;};this.objImage=image;this.setStatsBasedOnDifficulty(level);}
TieFighterObject.prototype.setStatsBasedOnDifficulty=function(level){var factor=GameLogic.getDifficultyFactor(level);this.health=this.maxHealth=(this.maxHealth+factor);};return TieFighterObject;})(ShipObject);GameObjects.TieFighterObject=TieFighterObject;var DestroyerObject=(function(_super){__extends(DestroyerObject,_super);function DestroyerObject(currentX,currentY,canvasWidth,canvasHeight,startTime,level){_super.call(this,currentX,currentY,canvasWidth,canvasHeight,CONSTANTS.DESTROYER_SPEED,Constants.ShipType.EMPIRE_DESTROYER,startTime,CONSTANTS.DESTROYER_HEALTH,CONSTANTS.DESTROYER_HEIGHT_HIT_FACTOR,level);var image=new Image();image.src='images/Destroyer3.png';image.onload=function(){isDestroyerLoaded=true;};this.objImage=image;}
DestroyerObject.prototype.setStatsBasedOnDifficulty=function(level){var factor=GameLogic.getDifficultyFactor(level);this.health=this.maxHealth=(this.maxHealth+(factor*2));};return DestroyerObject;})(ShipObject);GameObjects.DestroyerObject=DestroyerObject;var BossShipObject=(function(_super){__extends(BossShipObject,_super);function BossShipObject(currentX,currentY,canvasWidth,canvasHeight,speed,type,startTime,health,heightHitFactor,cannonShotType,cannonShotSpeed,cannonShotFireRate,cannonShotLimit,numberOfExtraShots,missileType,missileSpeed,missileFireRate,missileLimit,level){_super.call(this,currentX,currentY,canvasWidth,canvasHeight,speed,type,startTime,health,heightHitFactor,level);this.cannonShotType=cannonShotType;this.cannonShotSpeed=cannonShotSpeed;this.cannonShotFireRate=cannonShotFireRate;this.cannonShotLimit=cannonShotLimit;this.numberOfExtraShots=numberOfExtraShots;this.nextFireTimeShot=this.getNextFireDate(Date.now(),Constants.ProjectileType.IMPERIAL_SHOT);this.missileType=missileType;this.missileSpeed=missileSpeed;this.missileFireRate=missileFireRate;this.missileLimit=missileLimit;this.nextFireTimeMissile=this.getNextFireDate(Date.now(),Constants.ProjectileType.IMPERIAL_MISSILE);this.setStatsBasedOnDifficulty(level);}
BossShipObject.prototype.moveEnemyShip=function(pixels){var step=(pixels*this.speed);var point=this.nextWaypoint.getNextLocation(this.getLocationX(),this.getLocationY(),step);this.locationX=point.targetX;this.locationY=point.targetY;if(this.isAtTarget(point)){this.nextWaypoint=this.getNewRandomWaypoint();}};BossShipObject.prototype.getNewRandomWaypoint=function(){return Vector.getRandomWaypoint(this.getPathMinLimitX(),this.getPathMaxLimitX(),this.getPathMinLimitY(),this.getPathMaxLimitY());};BossShipObject.prototype.getNewSpecificTarget=function(targetX,targetY,targetVelocityX,targetVelocityY,projectileSpeed){return Vector.getTargetedWaypoint(this.getLocationX(),this.getLocationY(),targetX,targetY,targetVelocityX,targetVelocityY,projectileSpeed);};BossShipObject.prototype.getPathMinLimitX=function(){return 0;};BossShipObject.prototype.getPathMinLimitY=function(){return 0;};BossShipObject.prototype.getPathMaxLimitX=function(){return(this.maxWidth-this.objImage.naturalWidth);};BossShipObject.prototype.getPathMaxLimitY=function(){return(this.maxHeight/2);};BossShipObject.prototype.getNumberOfExtraShots=function(){if(this.numberOfExtraShots!=null){return this.numberOfExtraShots;}
else{return 0;}};BossShipObject.prototype.isTargeting=function(type){switch(type){case Constants.ProjectileType.IMPERIAL_MISSILE:return this.isTargetingMissiles;break;default:return this.isTargetingShots;break;}};BossShipObject.prototype.isAtTarget=function(currentPoint){var atTargetX=false;var atTargetY=false;if(currentPoint.targetX+this.objImage.naturalWidth>browserWidth){atTargetX=true;}
else if(Math.ceil(currentPoint.targetX)==this.nextWaypoint.targetX||Math.floor(currentPoint.targetX)==this.nextWaypoint.targetX){atTargetX=true;}
if(Math.ceil(currentPoint.targetY)==this.nextWaypoint.targetY||Math.floor(currentPoint.targetY)==this.nextWaypoint.targetY){atTargetY=true;}
return(atTargetX&&atTargetY);};BossShipObject.prototype.getNextFireDate=function(time,type){var seconds=0;switch(type){case Constants.ProjectileType.IMPERIAL_MISSILE:seconds=this.missileFireRate;break;default:seconds=this.cannonShotFireRate;break;}
return GameLogic.addSecondsToDate(time,seconds);};BossShipObject.prototype.setNewFireTime=function(time,type){switch(type){case Constants.ProjectileType.IMPERIAL_MISSILE:this.nextFireTimeMissile=this.getNextFireDate(Date.now(),Constants.ProjectileType.IMPERIAL_MISSILE);break;default:this.nextFireTimeShot=this.getNextFireDate(Date.now(),Constants.ProjectileType.IMPERIAL_SHOT);break;}};BossShipObject.prototype.isTimeToFire=function(time,type){var fireTime=0;switch(type){case Constants.ProjectileType.IMPERIAL_MISSILE:fireTime=this.nextFireTimeMissile.getTime();break;default:fireTime=this.nextFireTimeShot.getTime();break;}
if(time>fireTime){return true;}
else{return false;}};BossShipObject.prototype.isMultiShot=function(type){switch(type){case Constants.ProjectileType.TURRET_SPRAY:case Constants.ProjectileType.IMPERIAL_SHOT:return true;break;default:return false;break;}};BossShipObject.prototype.setStatsBasedOnDifficulty=function(level){var factor=GameLogic.getDifficultyFactor(level);this.health=this.maxHealth=(this.maxHealth+(this.maxHealth*(1/5)*factor));this.cannonShotSpeed+=(this.cannonShotSpeed*(1/4)*factor);this.cannonShotFireRate+=(this.cannonShotFireRate*(1/4)*factor);this.missileSpeed+=(this.missileSpeed*(1/4)*factor);this.missileFireRate+=(this.missileFireRate*(1/4)*factor);};return BossShipObject;})(ShipObject);GameObjects.BossShipObject=BossShipObject;var CommanderObject=(function(_super){__extends(CommanderObject,_super);function CommanderObject(currentX,currentY,canvasWidth,canvasHeight,startTime,level){_super.call(this,currentX,currentY,canvasWidth,canvasHeight,CONSTANTS.COMMANDER_SPEED,Constants.ShipType.EMPIRE_COMMANDER,startTime,CONSTANTS.COMMANDER_HEALTH,CONSTANTS.COMMANDER_HEIGHT_HIT_FACTOR,Constants.ProjectileType.IMPERIAL_SHOT,CONSTANTS.IMPERIAL_SHOT_SPEED,CONSTANTS.COMMANDER_IMPERIAL_SHOT_FIRE_RATE,CONSTANTS.COMMANDER_IMPERIAL_SHOT_LIMIT,0,null,0,0,0,level);var image=new Image();image.src='images/Commander2.png';image.onload=function(){isCommanderLoaded=true;};this.objImage=image;this.cannonShotList=GameLogic.getPopulatedProjectileList(this.cannonShotType,this.cannonShotSpeed,this.cannonShotLimit,canvasWidth,canvasHeight,level);this.missileList=new Array();this.nextWaypoint=this.getNewRandomWaypoint();this.isTargetingShots=true;this.isTargetingMissiles=false;}
CommanderObject.prototype.getProjectileLocationStartX=function(){return this.getLocationX()+(this.objImage.naturalWidth);};CommanderObject.prototype.getProjectileLocationStartY=function(offset){return this.getLocationY()+(this.objImage.naturalHeight/2);};return CommanderObject;})(BossShipObject);GameObjects.CommanderObject=CommanderObject;var DeathStarObject=(function(_super){__extends(DeathStarObject,_super);function DeathStarObject(currentX,currentY,canvasWidth,canvasHeight,startTime,level){_super.call(this,currentX,currentY,canvasWidth,canvasHeight,CONSTANTS.DEATH_STAR_SPEED,Constants.ShipType.EMPIRE_DEATH_STAR,startTime,CONSTANTS.DEATH_STAR_HEALTH,CONSTANTS.DEATH_STAR_HEIGHT_HIT_FACTOR,Constants.ProjectileType.IMPERIAL_SHOT,CONSTANTS.IMPERIAL_SHOT_SPEED,CONSTANTS.DEATH_STAR_IMPERIAL_SHOT_FIRE_RATE,CONSTANTS.DEATH_STAR_IMPERIAL_SHOT_LIMIT,CONSTANTS.DEATH_STAR_NUM_MULTI_SHOT,Constants.ProjectileType.IMPERIAL_MISSILE,CONSTANTS.IMPERIAL_MISSILE_SPEED,CONSTANTS.DEATH_STAR_IMPERIAL_MISSILE_FIRE_RATE,CONSTANTS.DEATH_STAR_IMPERIAL_MISSILE_LIMIT,level);var image=new Image();image.src='images/DeathStar2.png';image.onload=function(){isDeathStarLoaded=true;};this.objImage=image;this.cannonShotList=GameLogic.getPopulatedProjectileList(this.cannonShotType,this.cannonShotSpeed,this.cannonShotLimit,canvasWidth,canvasHeight,level);this.missileList=GameLogic.getPopulatedProjectileList(this.missileType,this.missileSpeed,this.missileLimit,canvasWidth,canvasHeight,level);this.nextWaypoint=this.getNewRandomWaypoint();this.isTargetingShots=true;this.isTargetingMissiles=true;}
DeathStarObject.prototype.getProjectileLocationStartX=function(){return this.getLocationX()+CONSTANTS.DEATH_STAR_PROJECTILE_OFFSET_X;};DeathStarObject.prototype.getProjectileLocationStartY=function(offset){return this.getLocationY()+CONSTANTS.DEATH_STAR_PROJECTILE_OFFSET_Y;};DeathStarObject.prototype.getPathMaxLimitY=function(){return(this.maxHeight/4);};return DeathStarObject;})(BossShipObject);GameObjects.DeathStarObject=DeathStarObject;var BountyHunterObject=(function(_super){__extends(BountyHunterObject,_super);function BountyHunterObject(currentX,currentY,canvasWidth,canvasHeight,startTime,level){_super.call(this,currentX,currentY,canvasWidth,canvasHeight,CONSTANTS.BOUNTY_HUNTER_SPEED,Constants.ShipType.BOUNTY_HUNTER,startTime,CONSTANTS.BOUNTY_HUNTER_HEALTH,CONSTANTS.BOUNTY_HUNTER_HEIGHT_HIT_FACTOR,Constants.ProjectileType.TURRET_SPRAY,CONSTANTS.TURRET_SPRAY_SPEED,CONSTANTS.BOUNTY_HUNTER_TURRET_SPRAY_FIRE_RATE,CONSTANTS.BOUNTY_HUNTER_TURRET_SPRAY_LIMIT,CONSTANTS.BOUNTY_HUNTER_NUM_MULTI_SHOT,null,0,0,0,level);var image=new Image();image.src='images/Slave3.png';image.onload=function(){isBountyHunterLoaded=true;};this.objImage=image;this.cannonShotList=GameLogic.getPopulatedProjectileList(this.cannonShotType,this.cannonShotSpeed,this.cannonShotLimit,canvasWidth,canvasHeight,level);this.missileList=new Array();this.nextWaypoint=this.getNewRandomWaypoint();this.isTargetingShots=true;this.isTargetingMissiles=false;}
BountyHunterObject.prototype.getProjectileLocationStartX=function(){return this.getLocationX()+CONSTANTS.BOUNTY_HUNTER_PROJECTILE_OFFSET_X;};BountyHunterObject.prototype.getProjectileLocationStartY=function(offset){return this.getLocationY()+CONSTANTS.BOUNTY_HUNTER_PROJECTILE_OFFSET_Y;};BountyHunterObject.prototype.getPathMaxLimitY=function(){return(this.maxHeight/3);};return BountyHunterObject;})(BossShipObject);GameObjects.BountyHunterObject=BountyHunterObject;var SpriteSheetObject=(function(_super){__extends(SpriteSheetObject,_super);function SpriteSheetObject(x,y,canvasWidth,canvasHeight,sheetHeight,sheetWidth,numberOfFrames,ticksPerFrame,type,maxLoop,scaleRatio){_super.call(this,x,y,canvasWidth,canvasHeight,0,1);this.sheetHeight=sheetHeight;this.sheetWidth=sheetWidth;this.numberOfFrames=numberOfFrames;this.ticksPerFrame=ticksPerFrame;this.type=type;this.maxLoop=maxLoop;this.scaleRatio=scaleRatio;this.tickCount=0;this.isFinished=false;this.loopCount=0;}
SpriteSheetObject.prototype.update=function(){this.tickCount+=1;if(this.tickCount>this.ticksPerFrame){this.tickCount=0;if(this.frameIndex<this.numberOfFrames-1){this.frameIndex+=1;}
else{this.frameIndex=0;this.loopCount+=1;}}
if(this.loopCount>this.maxLoop){this.isFinished=true;}};SpriteSheetObject.prototype.render=function(canvasContext){canvasContext.drawImage(this.objImage,this.frameIndex*this.sheetWidth/this.numberOfFrames,0,this.sheetWidth/this.numberOfFrames,this.sheetHeight,this.getLocationX(),this.getLocationY(),this.sheetWidth/this.numberOfFrames*this.scaleRatio,this.sheetHeight*this.scaleRatio);};SpriteSheetObject.prototype.getLocationX=function(){return this.locationX-((this.sheetWidth/this.numberOfFrames)/2);};SpriteSheetObject.prototype.getLocationY=function(){return this.locationY-(this.objImage.naturalHeight/2);};return SpriteSheetObject;})(BaseGameObject);GameObjects.SpriteSheetObject=SpriteSheetObject;var ExplosionSmall=(function(_super){__extends(ExplosionSmall,_super);function ExplosionSmall(currentX,currentY,canvasWidth,canvasHeight){_super.call(this,currentX,currentY,canvasWidth,canvasHeight,128,1280,10,5,Constants.SpriteType.EXPLOSION_SMALL,1,1);var image=new Image();image.src='images/SmallExplosion.png';image.onload=function(){isExplosionSmallLoaded=true;};this.objImage=image;}
return ExplosionSmall;})(SpriteSheetObject);GameObjects.ExplosionSmall=ExplosionSmall;var ExplosionLarge=(function(_super){__extends(ExplosionLarge,_super);function ExplosionLarge(currentX,currentY,canvasWidth,canvasHeight){_super.call(this,currentX,currentY,canvasWidth,canvasHeight,240,1500,6,5,Constants.SpriteType.EXPLOSION_LARGE,1,1);var image=new Image();image.src='images/LargeExplosion.png';image.onload=function(){isExplosionLargeLoaded=true;};this.objImage=image;}
return ExplosionLarge;})(SpriteSheetObject);GameObjects.ExplosionLarge=ExplosionLarge;var Projectile=(function(_super){__extends(Projectile,_super);function Projectile(currentX,currentY,speed,canvasWidth,canvasHeight,type,id,now,radius,color,damage,level){this.isAlive=false;this.isFirst=true;this.type=type;this.id=id;this.createTime=now;this.radius=radius;this.color=color;this.damage=damage;this.isTargeted=false;_super.call(this,currentX,currentY,canvasWidth,canvasHeight,speed,level);}
Projectile.prototype.getMinimumX=function(){return this.locationX-this.radius;};Projectile.prototype.getMaximumX=function(){return this.locationX+this.radius;};Projectile.prototype.getMinimumY=function(){return this.locationY-this.radius;};Projectile.prototype.getMaximumY=function(){return this.locationY+this.radius;};Projectile.prototype.setTarget=function(targetX,targetY){this.isTargeted=true;this.targetWaypoint=new Vector.Waypoint(targetX,targetY);};Projectile.prototype.moveTowardTarget=function(pixels){var step=(pixels*this.speed);var point=this.targetWaypoint.getNextLocation(this.locationX,this.locationY,step);this.locationX=point.targetX;this.locationY=point.targetY;if((this.locationY>=this.maxHeight||this.locationY<1)||(this.locationX>=this.maxWidth||this.locationX<1)){this.isAlive=false;}};return Projectile;})(BaseGameObject);GameObjects.Projectile=Projectile;var EnemyKill=(function(){function EnemyKill(enemy,enemyStart,enemyMaxHealth,level){this.enemyType=enemy;this.enemyStartTime=enemyStart;this.enemyMaxHealth=enemyMaxHealth;this.level=level;this.killTime=new Date(Date.now());}
return EnemyKill;})();GameObjects.EnemyKill=EnemyKill;var Score=(function(){function Score(displayName,level){this.displayName=displayName;this.name=displayName.replace(' ','');this.levelStart=level;this.killList=new Array();this.gameDate=new Date(Date.now());this.currentScore=0;this.highScore=0;this.directHits=0;this.shotsFired=0;this.grandMasterScore=0;this.personalRecordDisplayed=false;this.grandMasterDisplayed=false;}
Score.prototype.updateScore=function(enemy,enemyStart,enemyMaxHealth,level){this.killList.push(new EnemyKill(enemy,enemyStart,enemyMaxHealth,level));this.currentScore+=enemyMaxHealth;};Score.prototype.isHighScore=function(){return(this.currentScore>this.highScore);};Score.prototype.getAccuracy=function(){if(this.shotsFired>0){return(this.directHits/this.shotsFired)*100;}
else{return 0;}};return Score;})();GameObjects.Score=Score;var HighScore=(function(){function HighScore(displayName,name,score){this.displayName=displayName;this.name=name;this.score=score;}
return HighScore;})();GameObjects.HighScore=HighScore;var Message=(function(){function Message(type,text,font,colorRgb1,colorRgb2,x,y,expireCount){this.type=type;this.text=text;this.font=font;this.colorRgb1=colorRgb1;this.colorRgb2=colorRgb2;this.x=x;this.y=y;this.expireCount=expireCount;this.isMainColor=false;this.renderCount=0;}
Message.prototype.incrementCount=function(){this.renderCount+=1;if(this.renderCount%5==0){this.isMainColor=!this.isMainColor;}};Message.prototype.getCurrentColor=function(){if(this.isMainColor){return this.colorRgb1;}
else{return this.colorRgb2;}};Message.prototype.getCurrentX=function(){return this.x;};Message.prototype.getCurrentY=function(){var currentY=this.y;this.y-=CONSTANTS.MESSAGE_RISE_FACTOR_Y;return currentY;};Message.prototype.isExpired=function(){if(this.expireCount>0){if(this.renderCount>this.expireCount){return true;}
else{return false;}}
else{if(this.y<1){return true;}
else{return false;}}};return Message;})();GameObjects.Message=Message;var ImageObject=(function(_super){__extends(ImageObject,_super);function ImageObject(positionX,positionY,canvasWidth,canvasHeight){this.type=Constants.SpriteType.INSTRUCTION_PANEL;var image=new Image();image.src='images/InstructionPanel3.png';image.onload=function(){isInstructionPanelLoaded=true;};this.objImage=image;_super.call(this,positionX,positionY,canvasWidth,canvasHeight,0,0);}
return ImageObject;})(BaseGameObject);GameObjects.ImageObject=ImageObject;})(GameObjects||(GameObjects={}));var GameLogic;(function(GameLogic){var CONSTANTS=new Constants.Constants();function buildEnemyListByLevel(currentLevel,browserWidth,browserHeight){var enemyShipList=new Array();var totalNumFighters=CONSTANTS.NUM_FIGHTERS_PER_LEVEL*currentLevel;var totalNumDestroyers=CONSTANTS.NUM_DESTROYERS_PER_LEVEL*currentLevel;addEnemyShips(enemyShipList,totalNumFighters,Constants.ShipType.EMPIRE_TIE_FIGHTER,browserWidth,browserHeight,currentLevel);addEnemyShips(enemyShipList,totalNumDestroyers,Constants.ShipType.EMPIRE_DESTROYER,browserWidth,browserHeight,currentLevel);return enemyShipList;}
GameLogic.buildEnemyListByLevel=buildEnemyListByLevel;function getBossListByLevel(currentLevel,browserWidth,browserHeight){var bossList=new Array();if(currentLevel%CONSTANTS.BOUNTY_HUNTER_LEVEL_FACTOR==0){addEnemyShips(bossList,1,Constants.ShipType.BOUNTY_HUNTER,browserWidth,browserHeight,currentLevel);}
else if(currentLevel%CONSTANTS.DEATH_STAR_LEVEL_FACTOR==0){addEnemyShips(bossList,1,Constants.ShipType.EMPIRE_DEATH_STAR,browserWidth,browserHeight,currentLevel);}
else if(currentLevel%CONSTANTS.COMMANDER_LEVEL_FACTOR==0){addEnemyShips(bossList,1,Constants.ShipType.EMPIRE_COMMANDER,browserWidth,browserHeight,currentLevel);}
if(bossList.length>0){Message.AddBossMessage();}
return bossList;}
GameLogic.getBossListByLevel=getBossListByLevel;function addEnemyShips(enemyShipList,numberOfShips,type,browserWidth,browserHeight,currentLevel){for(var i=0;i<numberOfShips;i++){var enemyShip=null;switch(type){case Constants.ShipType.EMPIRE_DEATH_STAR:case Constants.ShipType.EMPIRE_COMMANDER:case Constants.ShipType.BOUNTY_HUNTER:enemyShip=getNewBoss(type,browserWidth,browserHeight,currentLevel);break;default:enemyShip=getNewEnemyShip(type,browserWidth,browserHeight,currentLevel);break;}
enemyShipList.push(enemyShip);}}
function getNewEnemyShip(type,browserWidth,browserHeight,currentLevel){var ship=null;var randomX=getRandomInteger(0,browserWidth);var randomSeconds=getRandomInteger(0,(currentLevel*CONSTANTS.MAX_SECONDS_MULTIPLIER_PER_LEVEL));var randomTime=addSecondsToDate(Date.now(),(randomSeconds+CONSTANTS.LEVEL_LOAD_BUFFER_SECONDS));switch(type){case Constants.ShipType.EMPIRE_DESTROYER:ship=new GameObjects.DestroyerObject(randomX,0,browserWidth,browserHeight,randomTime,currentLevel);break;case Constants.ShipType.EMPIRE_TIE_FIGHTER:default:ship=new GameObjects.TieFighterObject(randomX,0,browserWidth,browserHeight,randomTime,currentLevel);break;}
return ship;}
function getNewBoss(type,browserWidth,browserHeight,currentLevel){var ship=null;var randomX=getRandomInteger((browserWidth/4),(browserWidth-(browserWidth/4)));var randomY=getRandomInteger(0,(browserHeight/2));var maxSeconds=(currentLevel*CONSTANTS.MAX_SECONDS_MULTIPLIER_PER_LEVEL);var maxTime=addSecondsToDate(Date.now(),(maxSeconds+CONSTANTS.LEVEL_LOAD_BUFFER_SECONDS));switch(type){case Constants.ShipType.EMPIRE_COMMANDER:ship=new GameObjects.CommanderObject(randomX,randomY,browserWidth,browserHeight,maxTime,currentLevel);break;case Constants.ShipType.BOUNTY_HUNTER:ship=new GameObjects.BountyHunterObject(randomX,randomY,browserWidth,browserHeight,maxTime,currentLevel);break;case Constants.ShipType.EMPIRE_DEATH_STAR:default:ship=new GameObjects.DeathStarObject(randomX,randomY,browserWidth,browserHeight,maxTime,currentLevel);break;}
return ship;}
function getRandomInteger(min,max){return Math.floor(Math.random()*(max-min+1))+min;}
GameLogic.getRandomInteger=getRandomInteger;function addSecondsToDate(dateNumber,seconds){return new Date(dateNumber+seconds*1000);}
GameLogic.addSecondsToDate=addSecondsToDate;function equipMissiles(currentLevel,missileList,browserWidth,browserHeight){if(currentLevel%CONSTANTS.ADD_MISSILE_LEVEL==0){var id=missileList.length;var radius=CONSTANTS.MISSILE_RADIUS;var color=CONSTANTS.MISSLE_PINK;var damage=CONSTANTS.MISSILE_DAMAGE;var missile=new GameObjects.Projectile(0,0,CONSTANTS.MISSILE_SPEED,browserWidth,browserHeight,Constants.ProjectileType.MISSILE,id,0,radius,color,damage,currentLevel);missileList.push(missile);Message.AddMissileMessage();}}
GameLogic.equipMissiles=equipMissiles;function checkRebelShipHealth(ship,currentLevel){if(currentLevel%CONSTANTS.ADD_HEALTH_LEVEL==0){ship.maxHealth+=1;ship.health+=1;Message.AddHealthMessage(1);}}
GameLogic.checkRebelShipHealth=checkRebelShipHealth;function getPopulatedProjectileList(type,speed,limit,canvasWidth,canvasHeight,currentLevel){var list=new Array();var radius=0;var color='';var damage=0;switch(type){case Constants.ProjectileType.MISSILE:radius=CONSTANTS.MISSILE_RADIUS;color=CONSTANTS.MISSLE_PINK;damage=CONSTANTS.MISSILE_DAMAGE;break;case Constants.ProjectileType.IMPERIAL_SHOT:radius=CONSTANTS.IMPERIAL_SHOT_RADIUS;color=CONSTANTS.IMPERIAL_RED;damage=CONSTANTS.IMPERIAL_SHOT_DAMAGE;break;case Constants.ProjectileType.IMPERIAL_MISSILE:radius=CONSTANTS.IMPERIAL_MISSILE_RADIUS;color=CONSTANTS.IMPERIAL_ORANGE;damage=CONSTANTS.IMPERIAL_MISSILE_DAMAGE;break;case Constants.ProjectileType.TURRET_SPRAY:radius=CONSTANTS.TURRET_SPRAY_RADIUS;color=CONSTANTS.TURRET_GREEN;damage=CONSTANTS.TURRET_SPRAY_DAMAGE;break;default:radius=CONSTANTS.CANNON_SHOT_RADIUS;color=CONSTANTS.CANNON_SHOT_BLUE;damage=CONSTANTS.CANNON_SHOT_DAMAGE;break;}
for(var i=0;i<limit;i++){list.push(new GameObjects.Projectile(0,0,speed,canvasWidth,canvasHeight,type,i,0,radius,color,damage,currentLevel));}
return list;}
GameLogic.getPopulatedProjectileList=getPopulatedProjectileList;function getUnusedProjectileId(list){var id=-1;var filteredList=getProjectilesByStatus(list,false);if(filteredList.length>0){id=filteredList[0].id;}
return id;}
function getProjectilesByStatus(list,isActive){return list.filter(function(proj){if(proj.type===Constants.ProjectileType.MISSILE&&!isActive){return(proj.isAlive===isActive&&proj.isFirst===true);}
else{return proj.isAlive===isActive;}});}
GameLogic.getProjectilesByStatus=getProjectilesByStatus;function fireProjectile(list,offset,ship,isTargeted,targetX,targetY){var id=getUnusedProjectileId(list);if(id>=0){var x=ship.getProjectileLocationStartX();var y=ship.getProjectileLocationStartY(offset);activateProjectile(id,list,x,y,isTargeted,targetX,targetY);return 1;}
else{return 0;}}
GameLogic.fireProjectile=fireProjectile;function activateProjectile(id,list,currentX,currentY,isTargeted,targetX,targetY){var index=list.map(function(proj){return proj.id;}).indexOf(id);list[index].createTime=Date.now();list[index].isAlive=true;list[index].isFirst=false;list[index].locationX=currentX;list[index].locationY=currentY;list[index].isTargeted=isTargeted;if(isTargeted){list[index].setTarget(targetX,targetY);}}
function resetProjectiles(list){list.forEach(function(proj){proj.isAlive=false;proj.isFirst=true;});}
GameLogic.resetProjectiles=resetProjectiles;function incrementProjectilePosition(list,modifier){list.forEach(function(proj){if(proj.isAlive){proj.moveLocationY(-modifier);if(proj.locationY<1){proj.isAlive=false;}}});}
GameLogic.incrementProjectilePosition=incrementProjectilePosition;function addHitAnimation(ship,list,browserWidth,browserHeight){var isDestroyed=ship.health>0?false:true;var x=ship.getExplosionX();var y=ship.getExplosionY();var type;if(isDestroyed){switch(ship.type){case Constants.ShipType.EMPIRE_DESTROYER:case Constants.ShipType.EMPIRE_COMMANDER:case Constants.ShipType.EMPIRE_DEATH_STAR:case Constants.ShipType.REBEL_MILLENIUM_FALCON:type=Constants.SpriteType.EXPLOSION_LARGE;break;default:type=Constants.SpriteType.EXPLOSION_SMALL;break;}}
else{switch(ship.type){default:type=Constants.SpriteType.EXPLOSION_SMALL;break;}}
addNewExplosion(explosionList,x,y,type,browserWidth,browserHeight);}
GameLogic.addHitAnimation=addHitAnimation;function addNewExplosion(list,x,y,type,browserWidth,browserHeight){switch(type){case Constants.SpriteType.EXPLOSION_LARGE:list.push(new GameObjects.ExplosionLarge(x,y,browserWidth,browserHeight));case Constants.SpriteType.EXPLOSION_SMALL:default:list.push(new GameObjects.ExplosionSmall(x,y,browserWidth,browserHeight));break;}}
function addNewMessage(list,type,text,startX,startY,fontSize){var font=fontSize.toString()+"px 'Orbitron'";var colorRgb1;var colorRgb2=CONSTANTS.FILL_YELLOW;var expireCount=CONSTANTS.MESSAGE_EXPIRE_COUNT;switch(type){case Constants.MessageType.ADD_HEALTH:case Constants.MessageType.ADD_MISSILE:colorRgb1=CONSTANTS.FILL_GREEN;colorRgb2=CONSTANTS.FILL_RED;break;case Constants.MessageType.HIGH_SCORE:colorRgb1=CONSTANTS.FILL_RED;break;case Constants.MessageType.NEW_BOSS:colorRgb1=CONSTANTS.FILL_ORANGE;colorRgb2=CONSTANTS.FILL_WHITE;break;case Constants.MessageType.QUOTE:colorRgb1=CONSTANTS.FILL_YELLOW;colorRgb2=CONSTANTS.FILL_WHITE;expireCount=0;break;default:colorRgb1=CONSTANTS.FILL_WHITE;break;}
list.push(new GameObjects.Message(type,text,font,colorRgb1,colorRgb2,startX,startY,expireCount));}
GameLogic.addNewMessage=addNewMessage;function getDifficultyFactor(level){var factor=0;var factorLevel=CONSTANTS.ENEMY_STAT_INCREASE_LEVEL;if(level>factorLevel){factor=Math.floor(factorLevel/level);}
return factor;}
GameLogic.getDifficultyFactor=getDifficultyFactor;function isCompliantBrowser(){var isCompliant=false;var ua=navigator.userAgent;var browserName=navigator.appName;var nVer=navigator.appVersion;var fullVersion=''+parseFloat(navigator.appVersion);var majorVer=parseInt(navigator.appVersion,10);var nameOffset,verOffset,ix;if((verOffset=ua.indexOf("Chrome"))!=-1){browserName="Chrome";fullVersion=ua.substring(verOffset+7);isCompliant=true;}
else if((verOffset=ua.indexOf("OPR/"))!=-1){browserName="Opera";fullVersion=ua.substring(verOffset+4);}
else if((verOffset=ua.indexOf("Opera"))!=-1){browserName="Opera";fullVersion=ua.substring(verOffset+6);if((verOffset=ua.indexOf("Version"))!=-1)
fullVersion=ua.substring(verOffset+8);}
else if((verOffset=ua.indexOf("MSIE"))!=-1){browserName="Microsoft Internet Explorer";fullVersion=ua.substring(verOffset+5);}
else if((verOffset=ua.indexOf("Safari"))!=-1){browserName="Safari";fullVersion=ua.substring(verOffset+7);if((verOffset=ua.indexOf("Version"))!=-1)
fullVersion=ua.substring(verOffset+8);}
else if((verOffset=ua.indexOf("Firefox"))!=-1){browserName="Firefox";fullVersion=ua.substring(verOffset+8);}
else if((nameOffset=ua.lastIndexOf(' ')+1)<(verOffset=ua.lastIndexOf('/'))){browserName=ua.substring(nameOffset,verOffset);fullVersion=ua.substring(verOffset+1);if(browserName.toLowerCase()==browserName.toUpperCase()){browserName=navigator.appName;}}
return isCompliant;}
GameLogic.isCompliantBrowser=isCompliantBrowser;})(GameLogic||(GameLogic={}));var Render;(function(Render){function hasBeenHit(enemy,cannonShotList,missileList){var isHit=false;var damage=0;damage+=doesListContainCollision(enemy.getLocationX(),enemy.getMaximumX(),enemy.getLocationY(),enemy.getMaximumY(),GameLogic.getProjectilesByStatus(cannonShotList,true));damage+=doesListContainCollision(enemy.getLocationX(),enemy.getMaximumX(),enemy.getLocationY(),enemy.getMaximumY(),GameLogic.getProjectilesByStatus(missileList,true));if(damage>0){enemy.health-=damage;isHit=true;}
return isHit;}
function GetEnemyProjectileDamage(list,rebelShip){var damage=0;list.forEach(function(enemyShip){damage+=doesListContainCollision(rebelShip.getLocationX(),rebelShip.getMaximumX(),rebelShip.getLocationY(),rebelShip.getMaximumY(),GameLogic.getProjectilesByStatus(enemyShip.cannonShotList,true));damage+=doesListContainCollision(rebelShip.getLocationX(),rebelShip.getMaximumX(),rebelShip.getLocationY(),rebelShip.getMaximumY(),GameLogic.getProjectilesByStatus(enemyShip.missileList,true));});if(damage>0){GameLogic.addHitAnimation(rebelShip,explosionList,browserWidth,browserHeight);}
return damage;}
Render.GetEnemyProjectileDamage=GetEnemyProjectileDamage;function doesListContainCollision(minX,maxX,minY,maxY,list){var damage=0;var hasOverlapX=false;var hasOverlapY=false;list.forEach(function(proj){if(damage==0){hasOverlapX=isOverlapPresent(minX,maxX,proj.getMinimumX(),proj.getMaximumX());hasOverlapY=isOverlapPresent(minY,maxY,proj.getMinimumY(),proj.getMaximumY());if(hasOverlapX&&hasOverlapY){damage=proj.damage;proj.isAlive=false;}}});return damage;}
function moveEnemyProjectiles(modifier,list){list.forEach(function(ship){incrementProjectilePosition(ship.cannonShotList,modifier);incrementProjectilePosition(ship.missileList,modifier);});}
Render.moveEnemyProjectiles=moveEnemyProjectiles;function moveRebelProjectiles(modifier,list){incrementProjectilePosition(list,modifier);}
Render.moveRebelProjectiles=moveRebelProjectiles;function incrementProjectilePosition(list,modifier){list.forEach(function(proj){if(proj.isAlive){if(!proj.isTargeted){proj.moveLocationY(-modifier);if(proj.locationY<1){proj.isAlive=false;}}
else{proj.moveTowardTarget(modifier);}}});}
function moveEnemyShips(modifier,timeNow,enemyShipList){var damage=0;for(var i=0;i<enemyShipList.length;i++){var type=enemyShipList[i].type;if(enemyShipList[i].startTimeIsValid(timeNow)){if(GameObjects.isShipLoaded(enemyShipList[i].type)){enemyShipList[i].moveEnemyShip(modifier);}
if(enemyShipList[i].isAtBottomOfScreen()){damage+=enemyShipList[i].health;enemyShipList.splice(i,1);}}}
return damage;}
Render.moveEnemyShips=moveEnemyShips;function moveBosses(modifier,timeNow,bossList){for(var i=0;i<bossList.length;i++){var type=bossList[i].type;if(bossList[i].startTimeIsValid(timeNow)){if(GameObjects.isShipLoaded(bossList[i].type)){bossList[i].moveEnemyShip(modifier);fireEnemyProjectile(bossList[i],modifier,timeNow,bossList[i].cannonShotList);fireEnemyProjectile(bossList[i],modifier,timeNow,bossList[i].missileList);}}}}
Render.moveBosses=moveBosses;function fireEnemyProjectile(boss,modifier,timeNow,list){if(list.length>0&&boss.isTimeToFire(timeNow,list[0].type)){var targetX=0;var targetY=0;if(boss.isTargeting(list[0].type)){var targetPoint=boss.getNewSpecificTarget(rebelShip.getLocationX(),browserHeight,rebelShip.getVelocityX(modifier),rebelShip.getVelocityY(),list[0].speed);targetX=targetPoint.targetX;targetY=targetPoint.targetY;}
else{targetX=GameLogic.getRandomInteger(0,browserWidth);targetY=browserHeight;}
GameLogic.fireProjectile(list,0,boss,true,targetX,targetY);if(boss.isMultiShot(list[0].type)){for(var i=0;i<boss.getNumberOfExtraShots();i++){GameLogic.fireProjectile(list,0,boss,true,GameLogic.getRandomInteger(0,browserWidth),browserHeight);}}
boss.setNewFireTime(timeNow,list[0].type);}}
function drawRebelShip(canvasContext,rebelShip){if(canvasContext&&GameObjects.isShipLoaded(rebelShip.type)){canvasContext.drawImage(rebelShip.objImage,rebelShip.getLocationX(),rebelShip.getLocationY());}}
Render.drawRebelShip=drawRebelShip;function drawEnemyShips(canvasContext,timeNow,enemyShipList,cannonShotList,missileList,currentUserScore,currentLevel){if(canvasContext&&enemyShipList.length>0){for(var i=0;i<enemyShipList.length;i++){if(GameObjects.isShipLoaded(enemyShipList[i].type)&&enemyShipList[i].startTimeIsValid(timeNow)){if(enemyShipList[i].showEntryMessage()){Message.AddEntryMessage(enemyShipList[i].type);}
canvasContext.drawImage(enemyShipList[i].objImage,enemyShipList[i].getLocationX(),enemyShipList[i].getLocationY());if(hasBeenHit(enemyShipList[i],cannonShotList,missileList)){GameLogic.addHitAnimation(enemyShipList[i],explosionList,browserWidth,browserHeight);currentUserScore.directHits+=1;if(enemyShipList[i].health<1){currentUserScore.updateScore(enemyShipList[i].type,enemyShipList[i].startDate,enemyShipList[i].maxHealth,currentLevel);enemyShipList.splice(i,1);}}}}}}
Render.drawEnemyShips=drawEnemyShips;function drawDummyShips(canvasContext,timeNow,enemyShipList){if(canvasContext&&enemyShipList.length>0){for(var i=0;i<enemyShipList.length;i++){if(GameObjects.isShipLoaded(enemyShipList[i].type)&&enemyShipList[i].startTimeIsValid(timeNow)){canvasContext.drawImage(enemyShipList[i].objImage,enemyShipList[i].getLocationX(),enemyShipList[i].getLocationY());}}}}
Render.drawDummyShips=drawDummyShips;function drawInfoPanel(canvasContext,currentLevel,enemies,rebelShipHealth,rebelShipMaxHealth,missileList,userScore){if(canvasContext){var level="Level: "+currentLevel;var remainingEnemies="Empire: "+enemies.toString();var health="Health: "+rebelShipHealth.toString();var missiles="Missiles: "+GameLogic.getProjectilesByStatus(missileList,false).length.toString();missiles+=" / "+missileList.length;var score="Score: "+userScore.toString();canvasContext.font="16px 'Press Start 2P'";canvasContext.textAlign="left";canvasContext.textBaseline="top";canvasContext.fillStyle=CONSTANTS.FILL_WHITE;canvasContext.fillText(level,CONSTANTS.INFO_TEXT_SPACING,CONSTANTS.INFO_TEXT_SPACING);canvasContext.fillStyle=CONSTANTS.FILL_YELLOW;canvasContext.fillText(remainingEnemies,CONSTANTS.INFO_TEXT_SPACING,CONSTANTS.INFO_TEXT_SPACING*2);canvasContext.fillText(missiles,CONSTANTS.INFO_TEXT_SPACING,CONSTANTS.INFO_TEXT_SPACING*3);var precent=(rebelShipHealth*100)/rebelShipMaxHealth;if(precent>=90){canvasContext.fillStyle=CONSTANTS.FILL_GREEN;}
else if(precent>=50){canvasContext.fillStyle=CONSTANTS.FILL_LIGHT_BLUE;}
else{canvasContext.fillStyle=CONSTANTS.FILL_RED;}
canvasContext.fillText(health,CONSTANTS.INFO_TEXT_SPACING,CONSTANTS.INFO_TEXT_SPACING*4);canvasContext.fillStyle=CONSTANTS.FILL_WHITE;canvasContext.fillText(score,CONSTANTS.INFO_TEXT_SPACING,CONSTANTS.INFO_TEXT_SPACING*5);if(bossList.length>0){canvasContext.fillStyle=CONSTANTS.FILL_ORANGE;canvasContext.fillText("Boss: "+bossList[0].health.toString(),CONSTANTS.INFO_TEXT_SPACING,CONSTANTS.INFO_TEXT_SPACING*6);}}}
Render.drawInfoPanel=drawInfoPanel;function drawMessageList(canvasContext,messageList){if(canvasContext&&messageList.length>0){var prevCount=0;for(var i=0;i<messageList.length;i++){if(prevCount==0||prevCount>CONSTANTS.MESSAGE_THROTTLE_COUNT){drawMessage(canvasContext,messageList[i]);if(messageList[i].isExpired()){messageList.splice(i,1);prevCount=0;}
else{prevCount=messageList[i].renderCount;}}}}}
Render.drawMessageList=drawMessageList;function drawMessage(canvasContext,msg){canvasContext.textAlign="center";canvasContext.textBaseline="top";canvasContext.font=msg.font;canvasContext.fillStyle=msg.getCurrentColor();canvasContext.fillText(msg.text,msg.getCurrentX(),msg.getCurrentY());msg.incrementCount();}
function drawRebelProjectiles(canvasContext,list){if(canvasContext){renderProjectileList(canvasContext,list);}}
Render.drawRebelProjectiles=drawRebelProjectiles;function drawEnemyProjectiles(canvasContext,list){if(canvasContext){list.forEach(function(ship){renderProjectileList(canvasContext,ship.cannonShotList);renderProjectileList(canvasContext,ship.missileList);});}}
Render.drawEnemyProjectiles=drawEnemyProjectiles;function renderProjectileList(canvasContext,list){if(canvasContext&&list.length>0){list.forEach(function(proj){if(proj.isAlive){canvasContext.beginPath();canvasContext.arc(proj.locationX,proj.locationY,proj.radius,0,2*Math.PI);canvasContext.fillStyle=CONSTANTS.getColor(proj.color);canvasContext.fill();canvasContext.closePath();}});}}
function isOverlapPresent(firstObjectFloor,firstObjectCeiling,secondObjectFloor,secondObjectCeiling){return(firstObjectFloor<=secondObjectCeiling&&secondObjectFloor<=firstObjectCeiling);}
function drawExplosions(canvasContext,list){if(canvasContext){for(var i=0;i<list.length;i++){if(GameObjects.isSpriteLoaded(list[i].type)){list[i].update();list[i].render(canvasContext);if(list[i].isFinished){list.splice(i,1);}}}}}
Render.drawExplosions=drawExplosions;function drawTitle(canvasContext){canvasContext.textAlign="center";canvasContext.textBaseline="top";canvasContext.font="80px 'Orbitron'";canvasContext.fillStyle=CONSTANTS.FILL_WHITE;canvasContext.fillText("REBEL WARS",browserWidth/2,browserHeight/4);}
Render.drawTitle=drawTitle;function drawChampion(canvasContext,text){canvasContext.textAlign="center";canvasContext.textBaseline="top";canvasContext.font="16px 'Press Start 2P'";canvasContext.fillStyle=CONSTANTS.FILL_LIGHT_BLUE;canvasContext.fillText("Grand Master Jedi: "+text,browserWidth/2,browserHeight/12);}
Render.drawChampion=drawChampion;function drawInstructionPanel(canvasContext,panel){if(canvasContext){if(GameObjects.isSpriteLoaded(panel.type)){canvasContext.drawImage(panel.objImage,panel.locationX,panel.locationY);}}}
Render.drawInstructionPanel=drawInstructionPanel;})(Render||(Render={}));var Modal;(function(Modal){var CONSTANTS=new Constants.Constants();function loadLevelCompleteModal(currentUserScore,currentLevel){var userNameLabel=window.document.getElementById('lvlCompleteUserName');var levelLabel=window.document.getElementById('lvlCompleteLevel');var scoreLabel=window.document.getElementById('lvlCompleteScore');userNameLabel.textContent=currentUserScore.displayName;levelLabel.textContent=currentLevel.toString();scoreLabel.textContent=currentUserScore.currentScore.toString();if(currentUserScore.isHighScore()&&!currentUserScore.personalRecordDisplayed){Message.AddPersonalRecordMessage();currentUserScore.personalRecordDisplayed=true;}
checkUserScore(currentUserScore,"levelCompleteHighScoreDiv");openLevelCompleteWindow();}
Modal.loadLevelCompleteModal=loadLevelCompleteModal;function getHighScoreData(){var data=localStorage.getItem(CONSTANTS.DEFAULT_HIGH_SCORE_COOKIE_NAME);if(data==null||data==""){return null;}
else{return JSON.parse(data);}}
function setHighScoreData(value){localStorage.setItem(CONSTANTS.DEFAULT_HIGH_SCORE_COOKIE_NAME,JSON.stringify(value));}
function setDefaultHighScoreData(){var defaultHighScoreList=new Array();defaultHighScoreList.push(new GameObjects.HighScore('Player 1','Player1',5));defaultHighScoreList.push(new GameObjects.HighScore('Player 2','Player1',20));defaultHighScoreList.push(new GameObjects.HighScore('Player 3','Player1',15));setHighScoreData(defaultHighScoreList);}
function getCurrentUserHighScoreData(name){var data=localStorage.getItem(CONSTANTS.DEFAULT_HIGH_SCORE_COOKIE_NAME+name);if(data==null||data==""){return"0";}
else{return JSON.parse(data);}}
function saveCurrentUserData(name,score){localStorage.setItem(CONSTANTS.DEFAULT_HIGH_SCORE_COOKIE_NAME+name,score.toString());}
function openWarningWindow(){var link=window.document.getElementById('warningLink');link.click();}
Modal.openWarningWindow=openWarningWindow;function openWelcomeWindow(){var list=populateHighScoreListObject();displayHighScoreData(list,"welcomeHighScoreDiv");var link=window.document.getElementById('welcomeLink');link.click();var welcomeUserNameTextbox=window.document.getElementById('welcomeUserName');welcomeUserNameTextbox.focus();}
Modal.openWelcomeWindow=openWelcomeWindow;function displayHighScoreData(list,divName){var table=document.createElement("table");table.classList.add("centerTable");if(list.length>0){var titleRow=document.createElement("tr");titleRow.classList.add("highScoreTableHeaderRow");var titleCell=document.createElement("td");titleCell.colSpan=3;titleCell.classList.add("highScoreTableHeader");var titleText=document.createTextNode("HIGH SCORES");titleCell.appendChild(titleText);titleRow.appendChild(titleCell);table.appendChild(titleRow);var headerRow=document.createElement("tr");headerRow.classList.add("highScoreHeaderRow");var headerCellRank=document.createElement("td");headerCellRank.classList.add("highScoreHeaderRank");var headerCellName=document.createElement("td");headerCellName.classList.add("highScoreHeaderName");var headerCellScore=document.createElement("td");headerCellScore.classList.add("highScoreHeaderScore");var headerRankText=document.createTextNode("RANK");var headerNameText=document.createTextNode("NAME");var headerScoreText=document.createTextNode("SCORE");headerCellRank.appendChild(headerRankText);headerCellName.appendChild(headerNameText);headerCellScore.appendChild(headerScoreText);headerRow.appendChild(headerCellRank);headerRow.appendChild(headerCellName);headerRow.appendChild(headerCellScore);table.appendChild(headerRow);for(var i=0;i<list.length;i++){var newRow=document.createElement("tr");var rankCell=document.createElement("td");rankCell.classList.add("highScoreDataRank");var nameCell=document.createElement("td");nameCell.classList.add("highScoreDataName");var scoreCell=document.createElement("td");scoreCell.classList.add("highScoreDataScore");var rankText=document.createTextNode(getRank(i));var nameText=document.createTextNode(list[i].displayName);var scoreText=document.createTextNode(list[i].score.toString());rankCell.appendChild(rankText);nameCell.appendChild(nameText);scoreCell.appendChild(scoreText);newRow.appendChild(rankCell);newRow.appendChild(nameCell);newRow.appendChild(scoreCell);table.appendChild(newRow);}}
var div=document.getElementById(divName);div.innerHTML="";div.appendChild(table);}
function getRank(position){switch(position){case 0:return"Grand Master";break;case 1:return"Master";break;case 2:return"Knight";break;case 3:return"Apprentice";break;case 4:return"Padawan";break;default:return"Youngling";}}
function populateHighScoreListObject(){var maxItems=CONSTANTS.MAX_HIGH_SCORES;return Service.getHighScoreList(maxItems);}
function loadGameOverModal(currentUserScore,currentLevel){var userNameLabel=window.document.getElementById('gameOverUserName');var levelLabel=window.document.getElementById('gameOverLevel');var scoreLabel=window.document.getElementById('gameOverScore');userNameLabel.textContent=currentUserScore.displayName;levelLabel.textContent=currentLevel.toString();scoreLabel.textContent=currentUserScore.currentScore.toString();currentUserScore.levelFinish=currentLevel;checkUserScore(currentUserScore,"gameOverHighScoreDiv");openGameOverWindow();}
Modal.loadGameOverModal=loadGameOverModal;function checkUserScoreOnQuit(score){checkUserScore(score,null);}
Modal.checkUserScoreOnQuit=checkUserScoreOnQuit;function checkUserScore(score,divName){if(score.isHighScore()){saveCurrentUserHighScore(score);}
if(divName!=null){var list=populateHighScoreListObject();displayHighScoreData(list,divName);}}
Modal.checkUserScore=checkUserScore;function getCurrentUserHighScore(name){var score=0;score=Number(Service.getHighScore(name));return score;}
Modal.getCurrentUserHighScore=getCurrentUserHighScore;function saveCurrentUserHighScore(score){Service.setHighScore(score);}
Modal.saveCurrentUserHighScore=saveCurrentUserHighScore;function closeWelcomeWindow(){var link=window.document.getElementById('closeWelcomeLink');link.click();}
Modal.closeWelcomeWindow=closeWelcomeWindow;function openLevelCompleteWindow(){var link=window.document.getElementById('levelCompleteLink');link.click();var continueButton=window.document.getElementById('buttonContinue');continueButton.focus();}
function closeLevelCompleteWindow(){var link=window.document.getElementById('closeLevelCompleteLink');link.click();}
Modal.closeLevelCompleteWindow=closeLevelCompleteWindow;function openGameOverWindow(){var link=window.document.getElementById('gameOverLink');link.click();var playAgainButton=window.document.getElementById('buttonPlayAgain');playAgainButton.focus();}
function closeGameOverWindow(){var link=window.document.getElementById('closeGameOverLink');link.click();}
Modal.closeGameOverWindow=closeGameOverWindow;function localStorageSupported(){try{return"localStorage"in window&&window["localStorage"]!==null;}
catch(e){return false;}}})(Modal||(Modal={}));var Message;(function(Message){var DeathStarMessageList=["You underestimate the power of the dark side!","You underestimate my power!","Give yourself to the Dark Side!","You can not disguise yourself from me, Jedi!"];var CommanderMessageList=["If you will not be turned, you will be destroyed!","Your feeble skills are no match for the power of the Dark Side!","Now you will pay the price for your lack of vision!","Your faith in your friends is your weakness!"];var BountyHunterMessageList=["Always a pleasure to meet a Jedi","All is proceeding as you wished, Lord Vader","Now let me show you the true power of a Mandalorian!","Your arrogance is the cause of your destruction, not me"];function GetMessageLocationX(){return(browserWidth/2);}
function GetMessageLocationY(){return(browserHeight-(rebelShip.objImage.naturalHeight*2));}
function GetQuoteLocationX(){return(browserWidth/2);}
function GetQuoteLocationY(){return(browserHeight/2);}
function AddEntryMessage(type){var index=Math.floor(Math.random()*4);switch(type){case Constants.ShipType.EMPIRE_DEATH_STAR:AddQuoteMessage(DeathStarMessageList[index]);break;case Constants.ShipType.EMPIRE_COMMANDER:AddQuoteMessage(CommanderMessageList[index]);break;case Constants.ShipType.BOUNTY_HUNTER:AddQuoteMessage(BountyHunterMessageList[index]);break;}}
Message.AddEntryMessage=AddEntryMessage;function AddQuoteMessage(text){GameLogic.addNewMessage(messageList,Constants.MessageType.QUOTE,text,GetQuoteLocationX(),GetQuoteLocationY(),24);}
function AddGameStartMessage(){GameLogic.addNewMessage(messageList,Constants.MessageType.GENERIC,"*** START GAME ***",GetMessageLocationX(),GetMessageLocationY(),32);}
Message.AddGameStartMessage=AddGameStartMessage;function AddHealthMessage(amount){GameLogic.addNewMessage(messageList,Constants.MessageType.ADD_HEALTH,"+"+amount.toString()+" Health",GetMessageLocationX(),GetMessageLocationY(),24);}
Message.AddHealthMessage=AddHealthMessage;function AddMissileMessage(){GameLogic.addNewMessage(messageList,Constants.MessageType.ADD_MISSILE,"+1 Missile",GetMessageLocationX(),GetMessageLocationY(),24);}
Message.AddMissileMessage=AddMissileMessage;function AddBossMessage(){GameLogic.addNewMessage(messageList,Constants.MessageType.NEW_BOSS,"^^^ BOSS DETECTED ^^^",GetMessageLocationX(),GetMessageLocationY(),32);}
Message.AddBossMessage=AddBossMessage;function AddPersonalRecordMessage(){GameLogic.addNewMessage(messageList,Constants.MessageType.GENERIC,"*** PERSONAL RECORD ***",GetMessageLocationX(),GetMessageLocationY(),32);}
Message.AddPersonalRecordMessage=AddPersonalRecordMessage;function AddPressSpacebarMessage(){GameLogic.addNewMessage(messageList,Constants.MessageType.GENERIC,"*** PRESS SPACEBAR TO START ***",GetMessageLocationX(),GetMessageLocationY(),32);}
Message.AddPressSpacebarMessage=AddPressSpacebarMessage;function AddNewHighScoreMessage(){GameLogic.addNewMessage(messageList,Constants.MessageType.HIGH_SCORE,"!!! NEW HIGH SCORE !!!",GetMessageLocationX(),GetMessageLocationY(),40);GameLogic.addNewMessage(messageList,Constants.MessageType.HIGH_SCORE,"### JEDI GRAND MASTER ###",GetMessageLocationX(),GetMessageLocationY(),40);}
Message.AddNewHighScoreMessage=AddNewHighScoreMessage;})(Message||(Message={}));var CONSTANTS=new Constants.Constants();var browserWidth=(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)-CONSTANTS.CLIENT_WINDOW_MARGIN;var browserHeight=(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight)-CONSTANTS.CLIENT_WINDOW_MARGIN;var gameCanvas=document.createElement("canvas");gameCanvas.width=browserWidth;gameCanvas.height=browserHeight;document.body.appendChild(gameCanvas);var intervalHolder=null;var atStartScreen=true;var isGameReady=false;var currentLevel=CONSTANTS.DEFAULT_START_LEVEL;var timePrevious=Date.now();var titleTimePrevious=0;var rebelShip=new GameObjects.RebelShipObject(browserWidth,browserHeight,currentLevel);var explosionList=new Array();var messageList=new Array();var enemyShipList=new Array();var bossList=new Array();var cannonShotList=GameLogic.getPopulatedProjectileList(Constants.ProjectileType.CANNON_SHOT,CONSTANTS.CANNON_SHOT_SPEED,CONSTANTS.CANNON_SHOT_LIMIT,gameCanvas.width,gameCanvas.height,currentLevel);var missileList=GameLogic.getPopulatedProjectileList(Constants.ProjectileType.MISSILE,CONSTANTS.MISSILE_SPEED,CONSTANTS.MISSILE_LIMIT,gameCanvas.width,gameCanvas.height,currentLevel);var rightArrowKeyed=false;var leftArrowKeyed=false;document.addEventListener("keydown",keyDownHandler,false);document.addEventListener("keyup",keyUpHandler,false);var currentUserScore=new GameObjects.Score("Anonymous",CONSTANTS.DEFAULT_START_LEVEL);var champion=Service.getChampion();var titleThemeSong=new Audio("sounds/MainThemeWhistle.mp3");titleThemeSong.loop=true;var instructionPanel=new GameObjects.ImageObject(0,0,browserWidth,browserHeight);if(GameLogic.isCompliantBrowser()){if(atStartScreen){titleTimePrevious=Date.now();titleThemeSong.play();showStartScreen();}
else{Modal.openWelcomeWindow();}}
else{Modal.openWarningWindow();}
function continueGame(){isGameReady=true;currentLevel+=1;resetObjects();GameLogic.equipMissiles(currentLevel,missileList,browserWidth,browserHeight);GameLogic.checkRebelShipHealth(rebelShip,currentLevel);loadEnemies();timePrevious=Date.now();}
function startOver(){currentLevel=CONSTANTS.DEFAULT_START_LEVEL;rebelShip=new GameObjects.RebelShipObject(browserWidth,browserHeight,currentLevel);isGameReady=true;resetObjects();currentUserScore.levelStart=currentLevel;currentUserScore.currentScore=0;missileList=GameLogic.getPopulatedProjectileList(Constants.ProjectileType.MISSILE,CONSTANTS.MISSILE_SPEED,CONSTANTS.MISSILE_LIMIT,gameCanvas.width,gameCanvas.height,currentLevel);loadEnemies();Message.AddGameStartMessage();timePrevious=Date.now();}
function loadEnemies(){enemyShipList=GameLogic.buildEnemyListByLevel(currentLevel,browserWidth,browserHeight);bossList=GameLogic.getBossListByLevel(currentLevel,browserWidth,browserHeight);}
function loadDummyEnemies(){enemyShipList=GameLogic.buildEnemyListByLevel(10,browserWidth,browserHeight);}
function resetObjects(){rebelShip.reset();GameLogic.resetProjectiles(cannonShotList);GameLogic.resetProjectiles(missileList);rightArrowKeyed=false;leftArrowKeyed=false;messageList.splice(0);}
function getRemainingEnemies(){return enemyShipList.length+bossList.length;}
function isExplosionsDone(){return(explosionList.length==0);}
function rebelShipUserInput(modifier){if(rightArrowKeyed){rebelShip.moveLocationX(modifier);rebelShip.direction=Constants.Direction.RIGHT;}
else if(leftArrowKeyed){rebelShip.moveLocationX(-modifier);rebelShip.direction=Constants.Direction.LEFT;}}
function keyDownHandler(event){keyHandler(true,event);}
function keyUpHandler(event){keyHandler(false,event);}
function keyHandler(isDown,event){var keyCode=event.keyCode||event.which;switch(keyCode){case CONSTANTS.KEY_UP:{if(!isDown){currentUserScore.shotsFired+=GameLogic.fireProjectile(cannonShotList,CONSTANTS.CANNON_SHOT_OFFSET_Y,rebelShip,false,0,0);}
break;}
case CONSTANTS.KEY_DOWN:{if(!isDown){currentUserScore.shotsFired+=GameLogic.fireProjectile(missileList,CONSTANTS.MISSILE_OFFSET_Y,rebelShip,false,0,0);}
break;}
case CONSTANTS.KEY_LEFT:{leftArrowKeyed=isDown;break;}
case CONSTANTS.KEY_RIGHT:{rightArrowKeyed=isDown;break;}
case CONSTANTS.KEY_ENTER:case CONSTANTS.KEY_SPACEBAR:{if(isGameReady){event.cancelBubble=true;event.returnValue=false;}
else if(atStartScreen){atStartScreen=false;titleThemeSong.currentTime=0;titleThemeSong.pause();}}}}
function startGame(){isGameReady=true;resetObjects();loadEnemies();Message.AddGameStartMessage();timePrevious=Date.now();main();}
function main(){var canvasContext=gameCanvas.getContext("2d");canvasContext.clearRect(0,0,gameCanvas.width,gameCanvas.height);var timeNow=Date.now();var delta=(timeNow-timePrevious)/1000;var damage=0;if(isGameReady){rebelShipUserInput(delta);Render.moveRebelProjectiles(delta,missileList);Render.moveRebelProjectiles(delta,cannonShotList);Render.moveEnemyProjectiles(delta,bossList);damage+=Render.GetEnemyProjectileDamage(bossList,rebelShip);damage+=Render.moveEnemyShips(delta,timeNow,enemyShipList);Render.moveBosses(delta,timeNow,bossList);rebelShip.health-=damage;Render.drawRebelShip(canvasContext,rebelShip);Render.drawEnemyShips(canvasContext,timeNow,enemyShipList,cannonShotList,missileList,currentUserScore,currentLevel);Render.drawEnemyShips(canvasContext,timeNow,bossList,cannonShotList,missileList,currentUserScore,currentLevel);Render.drawExplosions(canvasContext,explosionList);Render.drawRebelProjectiles(canvasContext,missileList);Render.drawRebelProjectiles(canvasContext,cannonShotList);Render.drawEnemyProjectiles(canvasContext,bossList);Render.drawInfoPanel(canvasContext,currentLevel,getRemainingEnemies(),rebelShip.health,rebelShip.maxHealth,missileList,currentUserScore.currentScore);Render.drawMessageList(canvasContext,messageList);if(rebelShip.health<1){isGameReady=false;Modal.loadGameOverModal(currentUserScore,currentLevel);}
else if(getRemainingEnemies()==0&&isExplosionsDone()){isGameReady=false;Modal.loadLevelCompleteModal(currentUserScore,currentLevel);}}
timePrevious=timeNow;requestAnimationFrame(main);};function showStartScreen(){var canvasContext=gameCanvas.getContext("2d");canvasContext.clearRect(0,0,gameCanvas.width,gameCanvas.height);var titleTimeNow=Date.now();var titleDelta=(titleTimeNow-titleTimePrevious)/1000;Render.moveEnemyShips(titleDelta,titleTimeNow,enemyShipList);if(messageList.length==0){Message.AddPressSpacebarMessage();}
if(enemyShipList.length==0){loadDummyEnemies();}
Render.drawTitle(canvasContext);Render.drawInstructionPanel(canvasContext,instructionPanel);Render.drawChampion(canvasContext,champion);Render.drawMessageList(canvasContext,messageList);Render.drawDummyShips(canvasContext,titleTimeNow,enemyShipList);titleTimePrevious=titleTimeNow;if(!atStartScreen){Modal.openWelcomeWindow();}
else{requestAnimationFrame(showStartScreen);}}
function UserIsReady(){var welcomeUserNameTextbox=window.document.getElementById('welcomeUserName');var name=welcomeUserNameTextbox.value;currentLevel=CONSTANTS.DEFAULT_START_LEVEL;currentUserScore=new GameObjects.Score(name,currentLevel);currentUserScore.highScore=Modal.getCurrentUserHighScore(name);Modal.closeWelcomeWindow();startGame();}
function UserContinue(){Modal.closeLevelCompleteWindow();continueGame();}
function UserPlayAgain(){if(currentUserScore.isHighScore()){Modal.saveCurrentUserHighScore(currentUserScore);currentUserScore.highScore=currentUserScore.currentScore;}
Modal.closeGameOverWindow();startOver();}
function UserQuitWelcome(){Modal.closeWelcomeWindow();currentUserScore=null;UserQuit();}
function UserQuitLevelComplete(){Modal.closeLevelCompleteWindow();UserQuit();}
function UserQuitGameOver(){Modal.closeGameOverWindow();UserQuit();}
function UserQuit(){if(currentUserScore!=null){Modal.checkUserScoreOnQuit(currentUserScore);}
champion=Service.getChampion();atStartScreen=true;titleTimePrevious=Date.now();titleThemeSong.play();showStartScreen();}